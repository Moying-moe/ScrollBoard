(this["webpackJsonpscroll-board"]=this["webpackJsonpscroll-board"]||[]).push([[0],{129:function(e,t,n){e.exports=n(251)},135:function(e,t,n){},246:function(e,t,n){},251:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),l=n.n(o);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(25),i=(n(134),n(135),n(37)),s=n.n(i),u=n(84);function m(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(e){var n,a;t(null===(n=e.target)||void 0===n||null===(a=n.result)||void 0===a?void 0:a.toString())},a.onerror=function(e){return n(e)},a.readAsText(e)}))}var d=n(256),f=n(257),p=n(49),b=n(259),v=n(254),h=n(260),y=n(255),g=n(261),E=n(262),x=n(28),w=n(263),k=n(264),S=n(110);function j(){var e=S.parse(window.location.search)["data-url"];return"string"===typeof e?e:void 0}var O,I=function(e){var t=e.onLoad,n=e.onStart,o=Object(a.useState)(),l=Object(c.a)(o,2),i=l[0],S=l[1],O=Object(a.useRef)(null),I=Object(a.useState)(null),C=Object(c.a)(I,2),T=C[0],R=C[1],P=function(){var e=Object(u.a)(s.a.mark((function e(n){var a,r,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null===(a=n.currentTarget.files)||void 0===a?void 0:a.item(0))){e.next=9;break}return e.next=4,m(r);case 4:o=e.sent,l=JSON.parse(o),S(r.name),R(l),t(l);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){(function(){var e=Object(u.a)(s.a.mark((function e(){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=j())){e.next=11;break}return e.next=4,fetch(n);case 4:return a=e.sent,e.next=7,a.json();case 7:r=e.sent,S(n),R(r),t(r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().catch((function(e){return console.error(e)}))}),[t]);var F=d.a.useForm(),A=Object(c.a)(F,1)[0];return r.a.createElement(f.a,{style:{borderColor:"transparent",boxShadow:"0 1px 2px -2px rgba(0, 0, 0, 0.16), 0 3px 6px 0 rgba(0, 0, 0, 0.12), 0 5px 12px 4px rgba(0, 0, 0, 0.09)"}},r.a.createElement("input",{type:"file",style:{display:"none"},multiple:!1,ref:O,onChange:P}),r.a.createElement(p.a,{justify:"center",style:{alignItems:"baseline"}},i?r.a.createElement("span",{style:{flexGrow:1,textAlign:"center",margin:"0 1em"}},i):null,r.a.createElement(b.a,{icon:r.a.createElement(w.a,null),onClick:function(){var e;return null===(e=O.current)||void 0===e?void 0:e.click()}},"\u52a0\u8f7d\u6570\u636e")),null===T?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{style:{margin:"1em 0"}}),r.a.createElement(p.a,{style:{marginTop:"1em"}},r.a.createElement(h.a,{column:{xs:1,lg:3},title:r.a.createElement("span",{style:{display:"inline-block",width:"100%",textAlign:"center",fontSize:"1.5em"}},T.name)},r.a.createElement(h.a.Item,{label:"\u6bd4\u8d5b\u65f6\u957f"},T.duration/6e4," \u5206\u949f"),r.a.createElement(h.a.Item,{label:"\u5c01\u699c\u65f6\u523b"},T.freezeTime/6e4,"  \u5206\u949f"),r.a.createElement(h.a.Item,{label:"\u7f5a\u65f6\u5355\u4f4d"},T.penaltyTime/6e4," \u5206\u949f"),r.a.createElement(h.a.Item,{label:"\u9898\u76ee\u6570\u91cf"},T.problems.length),r.a.createElement(h.a.Item,{label:"\u961f\u4f0d\u6570\u91cf"},T.teams.length),r.a.createElement(h.a.Item,{label:"\u63d0\u4ea4\u6570\u91cf"},T.submissions.length),r.a.createElement(h.a.Item,{label:"\u9898\u76ee\u989c\u8272",span:3},r.a.createElement(y.a,{style:{display:"inline-flex",flexWrap:"wrap"}},T.problems.map((function(e){return r.a.createElement(g.a,{key:e.id,style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}}))})))))),r.a.createElement(p.a,null,r.a.createElement(d.a,{form:A},r.a.createElement(d.a.Item,{name:"autoReveal",label:"\u81ea\u52a8\u8fd0\u884c",valuePropName:"checked"},r.a.createElement(E.a,null)))),r.a.createElement(p.a,{justify:"center"},r.a.createElement(x.a,{span:6,style:{display:"flex",justifyContent:"center"}},r.a.createElement(b.a,{icon:r.a.createElement(k.a,null),onClick:function(){return n({autoReveal:!!A.getFieldValue("autoReveal")})},style:{width:"100%"}},"\u5f00\u59cb")))))},C=n(90),T=(n(246),n(125)),R=s.a.mark(F);function P(e){e.teamStates.sort((function(e,t){return e.solved!==t.solved?-(e.solved-t.solved):e.penalty!==t.penalty?e.penalty-t.penalty:e.team.name!==t.team.name?e.team.name<t.team.name?-1:1:0}));var t=0,n=0,a=0;e.teamStates.forEach((function(e,r){(e.solved<t||e.penalty>n)&&(a=r+1),e.rank=a,t=e.solved,n=e.penalty}))}function F(e){var t,n,a,r,o,l,c,i;return s.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=!1;case 1:if(!(e.cursor.index>=0)){s.next=36;break}if(n=e.teamStates[e.cursor.index],!(a=n.problemStates.find((function(e){return e.state===O.Pending})))){s.next=27;break}return e.cursor.tick+=1,void(s.next=8);case 8:return o=a.unrevealedSubmissions.some((function(e){return e.accepted})),e.cursor.tick+=1,s.next=12,{teamId:n.team.id,problemId:a.problem.id,accepted:o};case 12:return o?(a.state=O.Passed,l=a.unrevealedSubmissions.findIndex((function(e){return e.accepted})),a.tryCount=a.tryCount-a.unrevealedSubmissions.length+l+1,a.acceptTime=a.unrevealedSubmissions[l].submitTime,n.solved+=1,n.penalty+=6e4*Math.floor(a.acceptTime/6e4)+e.contest.penaltyTime*(a.tryCount-1)):a.state=O.Failed,(r=a.revealedSubmissions).push.apply(r,Object(T.a)(a.unrevealedSubmissions)),a.unrevealedSubmissions=[],void(s.next=17);case 17:return c=n.rank,P(e),i=n.rank,console.log('team "'.concat(n.team.name.padEnd(30," "),'" rank ').concat(c," -> ").concat(i)),e.cursor.tick+=1,void(s.next=24);case 24:t=!0,s.next=34;break;case 27:if(t){s.next=32;break}return console.log("yield at cursor index = ",e.cursor.index),e.cursor.tick+=1,void(s.next=32);case 32:e.cursor.index-=1,t=!1;case 34:s.next=1;break;case 36:case"end":return s.stop()}}),R)}!function(e){e[e.Passed=0]="Passed",e[e.Failed=1]="Failed",e[e.Pending=2]="Pending",e[e.Untouched=3]="Untouched"}(O||(O={}));var A=n(124),z=n(88),L=n(258);function M(e){return e===O.Passed?"green":e===O.Failed?"red":e===O.Pending?"orange":void 0}var B=function(e){var t=e.data,n=e.options,o=Object(a.useState)(Object(a.useMemo)((function(){return function(e){var t=new Map;e.teams.forEach((function(n){t.set(n.id,{team:n,rank:0,solved:0,penalty:0,problemStates:e.problems.map((function(e){return{problem:e,revealedSubmissions:[],unrevealedSubmissions:[],state:O.Untouched,tryCount:0,acceptTime:null}}))})})),e.submissions.sort((function(e,t){return e.submitTime-t.submitTime})),e.submissions.forEach((function(n){var a=t.get(n.teamId);if(!a)throw new Error("invalid data");var r=a.problemStates.find((function(e){return e.problem.id===n.problemId}));if(!r)throw new Error("invalid data");r.state!==O.Passed&&(n.submitTime<e.freezeTime?(r.revealedSubmissions.push(n),r.tryCount+=1,n.accepted?(r.state=O.Passed,r.acceptTime=n.submitTime,a.solved+=1,a.penalty+=6e4*Math.floor(r.acceptTime/6e4)+e.penaltyTime*(r.tryCount-1)):r.state=O.Failed):(r.unrevealedSubmissions.push(n),r.tryCount+=1,r.state=O.Pending))}));var n=Array.from(t.entries()).map((function(e){return e[1]})),a={teamStates:n,contest:e,cursor:{index:n.length-1,tick:0}};return P(a),a}(t)}),[t])),l=Object(c.a)(o,2),i=l[0],s=l[1],u=Object(a.useState)(null),m=Object(c.a)(u,2),d=m[0],f=m[1],p=Object(a.useRef)(F(i)),b=Object(a.useRef)(null),v=Object(a.useState)(!1),h=Object(c.a)(v,2),y=h[0],g=h[1],E=Object(a.useState)(!1),x=Object(c.a)(E,2),w=x[0],k=x[1],S=Object(a.useCallback)((function(){console.log("handleNextStep");var e=i.cursor.index,t=p.current.next();if(i.cursor.index!==e&&i.cursor.index>=0){var n=i.teamStates[i.cursor.index],a=document.querySelector("#team-id-".concat(n.team.id)).getBoundingClientRect();window.scrollTo({left:0,top:window.scrollY+a.top-window.innerHeight/2,behavior:"smooth"})}return console.log("cursor index = ",i.cursor.index),t.done?f(null):t.value?(console.log("reveal highlight"),k(!0),f(t.value),setTimeout((function(){return S()}),1200),setTimeout((function(){S(),k(!1),console.log("unlocked")}),1500+(t.value.accepted?500:0))):f(null),s(Object(C.a)({},i)),t.done}),[i]);Object(a.useEffect)((function(){if(0===i.cursor.tick){var e=i.teamStates[i.cursor.index],t=document.querySelector("#team-id-".concat(e.team.id)).getBoundingClientRect().top+window.scrollY,n=0,a=function e(){window.scrollBy({left:0,top:t/10/60,behavior:"auto"}),(n+=1)<600?window.requestAnimationFrame(e):k(!1)};k(!0),setTimeout((function(){window.requestAnimationFrame(a)}),2e3)}}),[i]);var j=Object(a.useCallback)((function(e){w||(console.log("keydown"),"Enter"===e.key&&S())}),[S,w]);Object(a.useEffect)((function(){return document.addEventListener("keydown",j),function(){return document.removeEventListener("keydown",j)}}),[j]);var I=Object(a.useCallback)((function(){w||(console.log("click"),S())}),[S,w]);return Object(a.useEffect)((function(){return document.addEventListener("click",I),function(){return document.removeEventListener("click",I)}}),[I]),Object(a.useEffect)((function(){if(0!==i.cursor.tick&&n.autoReveal){var e=setInterval((function(){w||S()&&clearInterval(e)}),500);return function(){return clearInterval(e)}}}),[i,w,S,n]),Object(a.useEffect)((function(){if(d){var e=setInterval((function(){g(!y)}),400);return function(){return clearInterval(e)}}}),[d,y]),r.a.createElement(z.StickyContainer,{style:{width:"100%"}},r.a.createElement(z.Sticky,null,(function(e){var n=e.style;return r.a.createElement("table",{style:Object(C.a)({width:"100%",fontSize:"2em",textAlign:"center",backgroundColor:"white",zIndex:1024,boxShadow:"0 5px 8px 4px rgba(0, 0, 0, 0.09)"},n)},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"5%"}},r.a.createElement("span",{style:{position:"absolute",zIndex:2048,top:0,left:0,borderRadius:"50%",width:"6px",height:"6px",backgroundColor:w?"#ff4d4f":"#52c41a"}}),"Rank"),r.a.createElement("th",{style:{width:"25%"}},"Team"),r.a.createElement("th",{style:{width:"10%"}},"Score"),t.problems.map((function(e){return r.a.createElement("th",{key:e.id,style:{width:"".concat(60/t.problems.length,"%")}},r.a.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}})))})))))})),r.a.createElement(A.a,{style:{width:"100%",overflowAnchor:"none",fontSize:"2em",textAlign:"center"},duration:2e3},i.teamStates.map((function(e,t){var n=t===i.cursor.index;return r.a.createElement("table",{key:e.team.id,id:"team-id-".concat(e.team.id),style:{width:"100%",boxShadow:n?"0 5px 12px 4px rgba(0, 0, 0, 0.09), 0 -5px 12px 4px rgba(0, 0, 0, 0.09)":void 0}},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"5%"}},e.rank),r.a.createElement("td",{style:{width:"25%"}},e.team.name),r.a.createElement("td",{style:{width:"10%"}},"".concat(e.solved," - ").concat(Math.floor(e.penalty/6e4))),e.problemStates.map((function(t){var n=d&&d.teamId===e.team.id&&d.problemId===t.problem.id,a=r.a.createElement("span",{style:{display:"inline-block",minWidth:"4em",minHeight:"1em",borderRadius:"0.25em",backgroundColor:M(t.state),color:"white"},ref:n?b:null},t.state===O.Passed?"".concat(t.tryCount," - ").concat(Math.floor(t.acceptTime/6e4)):"".concat(t.tryCount)),o=n?r.a.createElement(L.a,{in:y,timeout:400,classNames:"problem-grid",nodeRef:b},a):a;return r.a.createElement("td",{key:t.problem.id,style:{width:"".concat(60/e.problemStates.length,"%")}},o)})))))}))))},q=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),n=t[0],o=t[1],l=Object(a.useState)(null),i=Object(c.a)(l,2),s=i[0],u=i[1],m=Object(a.useState)(!1),d=Object(c.a)(m,2),f=d[0],b=d[1],v=Object(a.useCallback)((function(e){b(!0),u(e),console.debug(n,e)}),[n]);return r.a.createElement(r.a.Fragment,null,f?null:r.a.createElement(p.a,{justify:"center",style:{marginTop:"0em",alignItems:"center",minHeight:"80vh"}},r.a.createElement(x.a,{span:24,lg:16},r.a.createElement(I,{onLoad:function(e){return o(e)},onStart:v}))),null!==n&&f?r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{justify:"center",style:{width:"calc(100vw - 4px)"}},r.a.createElement(B,{data:n,options:s})),r.a.createElement("div",{style:{minHeight:"50vh"}})):null)};l.a.render(r.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[129,1,2]]]);
//# sourceMappingURL=main.131d18ff.chunk.js.map